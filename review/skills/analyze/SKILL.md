# Analyze — 임팩트 분석 리포트

구현 전/후 변경사항의 ROI, 제약사항, 엣지케이스, 사이드 이펙트를 체계적으로 분석합니다.

**입력:** `$ARGUMENTS` — `[scope] [--focus roi|constraint|edge|side]`

---

## 인자 파싱 규칙

| 인자 | 필수 | 기본값 | 설명 |
|------|------|--------|------|
| scope | - | 세션 변경 | `branch`, `commit:<hash>`, `plan` 또는 텍스트 설명 |
| `--focus` | - | 전체 | 특정 분석 항목만 집중 (`roi`, `constraint`, `edge`, `side`) |
> scope는 첫 번째 위치 인자로 판별. `--focus`는 어디든 위치 가능.

---

## 인라인 컨텍스트

- 현재 브랜치: `!git branch --show-current`
- 메인 브랜치: `!git remote show origin 2>/dev/null | grep 'HEAD branch' | awk '{print $NF}' || echo main`
- 오늘 날짜: `!date +%Y-%m-%d`

---

## 동작 지침

### Step 1: 인자 파싱 및 스코프 결정

`$ARGUMENTS`에서 다음을 파싱합니다:

- **scope 판별**:
  - `branch` → 브랜치 전체 변경사항 분석 모드
  - `commit:<hash>` → 특정 커밋 분석 모드
  - `plan` 또는 그 외 텍스트 → 사용자 설명 기반 분석 모드
  - 인자 없음 → 세션 변경사항(현재 diff) 분석 모드
- `--focus` → `roi`, `constraint`, `edge`, `side` 중 하나. 지정 시 해당 섹션만 출력
### Step 2: 변경사항 수집

#### scope: `branch`

```bash
git diff main...HEAD --stat
git diff main...HEAD
```

#### scope: `commit:<hash>`

```bash
git show <hash> --stat
git show <hash>
```

#### scope: 세션 변경 (기본)

```bash
git status
git diff
git diff --cached
```

#### scope: `plan` 또는 텍스트

- 사용자가 제공한 텍스트 설명을 분석 대상으로 사용
- 코드베이스를 탐색하여 관련 파일/모듈을 식별

### Step 3: 컨텍스트 수집 (서브 에이전트 활용)

변경 영향 범위를 파악하기 위해 **Task(Explore) 에이전트**를 활용합니다.

코드베이스 규모가 클 경우 최대 3개 Explore 에이전트를 **병렬로** 실행합니다:

- **에이전트 1**: 변경 파일의 **직접 의존성** 탐색 — 변경 파일이 import하는 모듈/패키지 추적
- **에이전트 2**: 변경 파일의 **소비자** 탐색 — 변경 파일을 import/사용하는 다른 파일 추적
- **에이전트 3**: **관련 테스트 및 설정** 탐색 — `*.test.*`, `*.spec.*`, `test_*`, `__tests__/`, 설정 파일 탐색

수집 항목:
- 변경된 파일/모듈의 의존 관계
- 관련 테스트 파일 존재 여부
- 영향받는 API/인터페이스 식별
- 관련 설정 파일 (config, env 등)

### Step 4: 4가지 관점 분석

수집된 정보를 바탕으로 아래 4가지 관점에서 분석합니다. `--focus`가 지정된 경우 해당 섹션만 분석합니다.

#### 4-1. ROI (투자 대비 효과) — `--focus roi`

- **효과**: 이 변경이 가져오는 구체적 가치 (성능 개선, UX 향상, 기술 부채 해소 등)
- **비용**: 구현 복잡도, 유지보수 부담, 리뷰/테스트 비용
- **우선순위 판단**: 높음/보통/낮음 + 근거

#### 4-2. 제약사항 (Constraints) — `--focus constraint`

- 기술적 제약 (언어/프레임워크 한계, 호환성 등)
- 비즈니스 제약 (일정, 리소스, 정책 등)
- 의존성 제약 (외부 라이브러리, API 버전, 하위 호환성 등)

#### 4-3. 엣지케이스 (Edge Cases) — `--focus edge`

각 엣지케이스에 대해:
- **시나리오**: 구체적 상황 설명
- **현재 처리**: 처리됨 / 미처리
- **위험도**: 높음 / 보통 / 낮음

#### 4-4. 사이드 이펙트 (Side Effects) — `--focus side`

- **영향 범위**: 영향받는 모듈/파일 목록
- 예상 부작용 (성능 저하, 동작 변경, 데이터 포맷 변경 등)
- 하위 호환성 깨짐 여부

### Step 5: 결과 출력

아래 형식으로 출력합니다:

```
# 임팩트 분석 리포트
> 스코프: {scope 설명} | 분석일: {날짜}

## ROI (투자 대비 효과)
- **효과**: {이 변경이 가져오는 가치}
- **비용**: {구현/유지보수 비용 예측}
- **우선순위 판단**: {높음/보통/낮음 + 근거}

## 제약사항 (Constraints)
- {기술적 제약}
- {비즈니스 제약}
- {의존성 제약}

## 엣지케이스 (Edge Cases)
### {엣지케이스 1}
- **시나리오**: {구체적 상황}
- **현재 처리**: {처리됨/미처리}
- **위험도**: {높음/보통/낮음}

### {엣지케이스 2}
...

## 사이드 이펙트 (Side Effects)
- **영향 범위**: {영향받는 모듈/파일 목록}
- {예상 부작용 1}
- {예상 부작용 2}

## 총정리

| 항목 | 판단 | 핵심 요약 |
|------|------|-----------|
| ROI | {높음/보통/낮음} | {한 줄 요약} |
| 제약사항 | {N}건 | {가장 중요한 제약} |
| 엣지케이스 | {N}건 ({미처리}건 미처리) | {가장 위험한 케이스} |
| 사이드이펙트 | {N}건 | {가장 큰 영향} |

**종합 의견**: {변경사항에 대한 1-2문장 종합 판단 — 진행 권장/주의 필요/재검토 권장}

**한 줄 요약**: [ROI: {판단}] [제약: {N}건] [엣지케이스: {N}건 ({미처리}건 미처리)] [사이드이펙트: {N}건]

---
엣지케이스 테스트가 필요하면: `/review:test-edge --from-analyze`
```

`--focus`가 지정된 경우 해당 섹션만 출력하되, 상단 헤더와 하단 안내는 유지합니다. 총정리 테이블은 항상 포함하되, `--focus` 지정 시 해당 항목 행만 표시합니다. **한 줄 요약**은 항상 포함합니다.

---

## 주의사항

- 분석 결과는 코드 변경 없이 **읽기 전용**으로 수행합니다
- 추측보다 코드 기반 근거를 우선합니다 — 실제 import/export 관계, 테스트 커버리지, 타입 정의를 확인
- 엣지케이스는 최소 3개 이상 도출합니다
- 사이드 이펙트의 영향 범위는 파일 경로를 구체적으로 명시합니다

---

## 사용 예시

```
/review:analyze                           # 세션 변경사항 전체 분석
/review:analyze branch                    # 브랜치 전체 변경 분석
/review:analyze commit:abc1234            # 특정 커밋 분석
/review:analyze plan 인증 시스템 리팩토링    # 텍스트 설명 기반 분석
/review:analyze --focus edge              # 엣지케이스만 집중 분석
```
